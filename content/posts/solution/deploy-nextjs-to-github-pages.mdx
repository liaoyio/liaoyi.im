---
title: Next.js é¡¹ç›®é™æ€éƒ¨ç½²åˆ° GitHub Pages
description: å°† Next.js é¡¹ç›®é™æ€éƒ¨ç½²åˆ° GitHub Pages æŒ‡åŒ— ğŸª…
date: 2025-04-28
author: 'liaoyi'
tags: [Deploy, Fumadocs, Next.js, 'Static site' ]
---

åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé¡¹ç›®éƒ¨ç½²åšå¦‚ä¸‹å‡†å¤‡ï¼š

<Steps>

<Step>

## è®¾ç½®é™æ€å¯¼å‡º


```ts title="next.config.mjs"
import { createMDX } from 'fumadocs-mdx/next'

/** @type {import('next').NextConfig} */
const config = {
  reactStrictMode: true,
  output: 'export', // è®¾ç½®é™æ€å¯¼å‡º
  pageExtensions: ['js', 'jsx', 'md', 'mdx', 'ts', 'tsx'],
  images: { unoptimized: true },
  experimental: { viewTransition: true },
  typescript: { ignoreBuildErrors: true },
  eslint: { ignoreDuringBuilds: true },
  serverExternalPackages: [
    'ts-morph',
    'typescript',
    'oxc-transform',
    'twoslash',
  ],
}
const withMDX = createMDX()
export default withMDX(config)

```

</Step>

<Step>

## ä½¿ç”¨é™æ€æœç´¢

è¦ä½¿ç”¨ Next.js é™æ€å¯¼å‡ºï¼Œæˆ‘ä»¬éœ€è¦å°† Fumadocs çš„æœç´¢åŠŸèƒ½æ”¹ä¸ºé™æ€ï¼Œå‚è€ƒ [Static Export](https://fumadocs.dev/docs/headless/search/orama#static-export)


1. ä½¿ç”¨é™æ€æœç´¢
åœ¨ src/app/api/search/route.ts ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```ts title="src/app/api/search/route.ts"
import { createSearchAPI } from 'fumadocs-core/search/server'
import { postsSource } from '@/lib/source'

export const revalidate = false

export const { staticGET: GET } = createSearchAPI('advanced', {
  indexes: [
    ...postsSource
      .getPages()
      .filter(page => !page.data.draft) // Filter out draft posts
      .map((page) => {
        return {
          title: page.data.title,
          description: page.data.description,
          url: page.url,
          id: page.url,
          structuredData: page.data.structuredData,
          tag: 'blog',
        }
      }),
  ],
})
```

2. é…ç½®é™æ€æœç´¢ä½¿å…¶ç”Ÿæ•ˆï¼ˆéå¿…è¦ï¼‰

ä½ å¯ä»¥åœ¨ src/app/layout.tsx ä¸­ï¼Œå£°æ˜å¼çš„æ·»åŠ  `static` æ ‡è®°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸é…ç½®ï¼Œfumadocs é»˜è®¤ä¼šè‡ªåŠ¨åŒ¹é…ã€‚

```ts title="src/app/layout.tsx"
import { RootProvider } from 'fumadocs-ui/provider'

export default function Layout({ children }: { children: ReactNode }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={cn('relative flex min-h-svh flex-col overflow-x-hidden')}>
        <RootProvider search={{ options: { type: 'static' } }}> // [!code highlight]
          {children}
        </RootProvider> // [!code highlight]
      </body>
    </html>
  )
}
```

</Step>


<Step>


## ç¼–å†™ workflow

åœ¨ä½ çš„é¡¹ç›®æ ¹ç›®å½•æ–°å»º `.github/workflows/deploy.yml` æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹ workflows è„šæœ¬ï¼š

```yml title=".github/workflows/deploy.yml"

# ä½¿ç”¨ pnpm æ„å»ºNext.jsé™æ€ç«™ç‚¹ï¼Œå¹¶éƒ¨ç½²åˆ° GitHub Pages çš„å·¥ä½œæµ

name: Deploy Next.js site to Pages # workflow åç§°
#  ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹è§¦å‘ workflow
on:
  # å½“ä»£ç æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨è¿è¡Œ
  push:
    branches: [main]

  # æ‰‹åŠ¨ç‚¹å‡» GitHub Actions çš„ â€œRun workflowâ€ æŒ‰é’®æ—¶è¿è¡Œ
  workflow_dispatch:

# ğŸ” æƒé™é…ç½®ï¼šè®¾ç½® GITHUB_TOKEN æƒé™ï¼Œä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# ğŸš¦ å¹¶å‘æ§åˆ¶ï¼šé˜²æ­¢åŒæ—¶éƒ¨ç½²å¤šä¸ªç‰ˆæœ¬ã€‚ç›¸åŒçš„éƒ¨ç½²ä¼šæ’é˜Ÿï¼Œä½†ä¸ä¼šä¸­æ–­å½“å‰è¿›è¡Œä¸­çš„éƒ¨ç½²
concurrency:
  group: pages
  cancel-in-progress: false

# ğŸ‘· æ„å»º Job
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: latest
          run_install: false

      - name: Get pnpm store directory
        id: pnpm-cache
        run: |
          echo "store-path=$(pnpm store path)" >> $GITHUB_OUTPUT

      - name: Setup pnpm cache
        uses: actions/cache@v4
        with:
          path: ${{ steps.pnpm-cache.outputs.store-path }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Setup Pages # é…ç½® GitHub Pages
        uses: actions/configure-pages@v4

      - name: Restore Next.js cache # ä½¿ç”¨ Next.js çš„æ„å»ºç¼“å­˜ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚
        uses: actions/cache@v4
        with:
          path: |
            .next/cache
          # æ¯å½“åŒ…æˆ–æºæ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œç”Ÿæˆæ–°çš„ç¼“å­˜
          key: ${{ runner.os }}-nextjs-${{ hashFiles('**/pnpm-lock.yaml') }}-${{ hashFiles('**.[jt]s', '**.[jt]sx') }}
          # å¦‚æœæºæ–‡ä»¶å·²æ›´æ”¹ï¼Œä½†åŒ…æœªæ›´æ”¹ï¼Œåˆ™ä½¿ç”¨ä¹‹å‰çš„ç¼“å­˜æ„å»º
          restore-keys: |
            ${{ runner.os }}-nextjs-${{ hashFiles('**/pnpm-lock.yaml') }}-

      - name: Install dependencies
        run: pnpm install

      - name: Build with Next.js
        run: pnpm build

      - name: Upload artifact # ä¸Šä¼ æ‰“åŒ…å¥½çš„æ–‡ä»¶
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./out

  # ğŸš€ éƒ¨ç½² Job
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build # ç­‰ build ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œéƒ¨ç½²
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

</Step>

<Step>

## åˆ›å»º GitHub è¿œç¨‹ä»“åº“

ç°åœ¨ï¼Œç™»å…¥ä½ çš„ GitHubï¼Œ æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œæ¯”å¦‚æˆ‘çš„ GitHub ä¸ªäººä¸»é¡µä¸º https://github.com/liaoyio ï¼Œé‚£ä¹ˆåˆ›å»ºçš„ä»“åº“åä¸º `liaoyio.github.io`ï¼Œä½¿ç”¨è¿™ä¸ªä»“åº“åæ˜¯å¿…è¦çš„ï¼Œä¼šå¸®ä½ çœå»å¾ˆå¤šè¸©å‘æ—¶é—´ã€‚

å¦‚æœä½ éè¦å›ºæ‰§å·±è§çš„ä½¿ç”¨å…¶ä»–æ ¼å¼çš„ä»“åº“åç§°å°† Next.js é™æ€å¯¼å‡ºå¹¶éƒ¨ç½²åˆ° GitHub Pagesï¼Œè¯·å‚è€ƒ [è‡ªå®šä¹‰ä»“åº“éƒ¨ç½²åˆ° GitHub Pages](#è‡ªå®šä¹‰ä»“åº“éƒ¨ç½²åˆ°-github-pages)



</Step>


<Step>

## æ¨é€ä»£ç åˆ°è¿œç¨‹ä»“åº“

å°†ä»£ç æ¨é€åˆ°ä½ åˆ›å»ºçš„è¿œç¨‹ä»“åº“ï¼Œæ¨é€åï¼Œ GitHub Actions å°†ä¼šè‡ªåŠ¨éƒ¨ç½²ç«™ç‚¹ï¼Œä½ å¯ä»¥å‰å¾€ä½ çš„è¿œç¨‹ä»“åº“é¡¹ç›®åœ°å€æŸ¥çœ‹ GitHub Actionsè¿è¡ŒçŠ¶æ€ï¼Œå½“éƒ¨ç½²æˆåŠŸåï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä½ çš„é¡¹ç›®åæŸ¥çœ‹æ•ˆæœã€‚

</Step>

</Steps>

---

## è‡ªå®šä¹‰ä»“åº“éƒ¨ç½²åˆ° GitHub Pages

ä»¥ä¸‹æ˜¯è®°å½•æˆ‘ä½¿ç”¨è‡ªå®šä¹‰ä»“åº“åå°† Next.js é™æ€å¯¼å‡ºåéƒ¨ç½²åˆ° GitHub Pages æ—¶ç¢°åˆ°çš„ä¸€äº›é—®é¢˜ã€‚

- GitHub ç”¨æˆ·åï¼š _liaoyio_
- ä»“åº“åç§°ï¼š_liaoyi.im_


###  1. é™æ€èµ„æºé—®é¢˜
å½“éƒ¨ç½²æˆåŠŸåæˆ‘è®¿é—® , å‘ç°æ— æ³•åŠ è½½é™æ€èµ„æº

```tsx
GitHub ä»“åº“åœ°å€ï¼š https://github.com/liaoyio/liaoyi.im
éƒ¨ç½²åè®¿é—®åœ°å€ï¼šhttps://liaoyio.github.io/liaoyi.im/
```

æ­¤æ—¶çš„é™æ€èµ„æºæŒ‡å‘ä¸ºï¼š

```tsx
 https://liaoyio.github.io/_next/static/css/6f5cc6a082c8cdf9.css
```

é—®é¢˜åŸå› ï¼šNext.js é»˜è®¤æ„å»ºå‡ºçš„è·¯å¾„æ˜¯åŸºäºæ ¹ç›®å½• `/`ï¼Œè€Œ GitHub Pages éƒ¨ç½²åˆ°çš„æ˜¯å­è·¯å¾„ `/liaoyi.im/`ã€‚

#### âœ… è§£å†³æ–¹æ¡ˆï¼š
é…ç½® `basePath` å’Œ `assetPrefix`

```tsx
// next.config.mjs

import { createMDX } from 'fumadocs-mdx/next'

/** @type {import('next').NextConfig} */
const config = {
  output: 'export',
  basePath: '/liaoyi.im',
  assetPrefix: '/liaoyi.im/',
  trailingSlash: true,
  //...
}
const withMDX = createMDX()
export default withMDX(config)
```



### 2. public è·¯å¾„é—®é¢˜

å½“è®¾ç½®å¥½  `basePath` å’Œ `assetPrefix` é‡æ–°éƒ¨ç½²åï¼Œé™æ€èµ„æºè®¿é—®çš„æˆåŠŸè§£å†³äº†ï¼Œä½†æ˜¯åœ¨è®¿é—®ç«™ç‚¹æ—¶ï¼Œæ›´æ£˜æ‰‹çš„é—®é¢˜å‡ºç°äº†ï¼Œ è‡ªå®šä¹‰ä»“åº“é‡Œ public/xxx.png çš„èµ„æºæ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

```plain
# GitHub ä»“åº“åœ°å€ public èµ„æºè·¯å¾„
https://github.com/liaoyio/liaoyi.im/public/avatar.jpg

# âŒ éƒ¨ç½²åï¼Œé™æ€ç«™ç‚¹è¯·æ±‚çš„ public èµ„æºè·¯å¾„
https://liaoyio.github.io/avatar.jpg

# âœ… éƒ¨ç½²åï¼Œé™æ€ç«™æœŸæœ›è¯·æ±‚çš„ public èµ„æºè·¯å¾„
https://liaoyio.github.io/liaoyi.im/avatar.jpg

```

<Callout type="warn">
  public æ–‡ä»¶å¤¹ä¸‹çš„èµ„æºè·¯å¾„é”™è¯¯ï¼Œè®¿é—®å˜æˆäº† `https://liaoyio.github.io/avatar.jpg` (è·¯å¾„ä¸¢å¤±äº† /liaoyi.im/)ã€‚
</Callout>


è¿™æ˜¯å› ä¸ºåœ¨ Next.js ä¸­ä½¿ç”¨ `public/avatar.jpg` æ—¶ï¼Œè·¯å¾„ä¼šè‡ªåŠ¨è§£æä¸º æ ¹è·¯å¾„ `/avatar.jpg`ï¼Œè¿™åœ¨ GitHub Pages å­è·¯å¾„éƒ¨ç½²ä¸­æ˜¯ æ— æ³•æ­£å¸¸å·¥ä½œçš„ã€‚



#### âš ï¸ è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ `next/config` è¯»å–è¿è¡Œæ—¶é…ç½®ï¼Œå°†é™æ€èµ„æºè·¯å¾„å†™æˆç›¸å¯¹ `basePath` çš„è·¯å¾„ã€‚



ä½¿ç”¨ basePath æ‹¼æ¥è·¯å¾„ï¼ˆæ¨èï¼‰

```typescript
import getConfig from 'next/config'
const { publicRuntimeConfig } = getConfig()


const avatarSrc = `${publicRuntimeConfig.basePath}/avatar.jpg`
```

å¹¶åœ¨ next.config.mjs ä¸­æ·»åŠ ï¼š

```typescript
const nextConfig = {
  output: 'export',
  basePath: '/liaoyi.im',  // ä½ çš„ GitHub Pages å­ä»“åº“è·¯å¾„
  assetPrefix: '/liaoyi.im/', // ä½ çš„ GitHub Pages å­ä»“åº“è·¯å¾„
  trailingSlash: true,
  publicRuntimeConfig: {
    basePath: '/liaoyi.im'
  }
}
```

ä½¿ç”¨ï¼š

```typescript
<img src={`${basePath}/avatar.jpg`} />
```

æ³¨æ„ä½¿ç”¨ next/image æ— éœ€æ‰‹åŠ¨æ·»åŠ è·¯å¾„ï¼ŒNext.js ä¼šè‡ªåŠ¨å°† /avatar.jpg æ›¿æ¢æˆ /liaoyi.im/avatar.jpgã€‚

```typescript
import Image from 'next/image'

<Image
  src="/avatar.jpg" // æ³¨æ„ï¼šä¿ç•™è¿™ä¸ªå†™æ³•
  width={100}
  height={100}
  alt="avatar"
/>
```


<Callout type="warn">
 å½“æœ‰ css è®¿é—® public æ–‡ä»¶èµ„æºæ—¶ï¼Œæ­¤æ–¹æ³•å°†æ— æ³•é€‚ç”¨ã€‚
</Callout>






